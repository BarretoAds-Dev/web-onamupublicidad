---
//NavBar component
import LogoBlanco from "@/components/ui/images/homepage/Logos.astro";
---


<!-- Botón Hamburguesa (Visible en Móviles) -->
<button
  id="menu-toggle"
  class="md:hidden mr-4 block p-1 rounded-md bg-green-400 text-bodydark hover:bg-green-500 hover:text-fontlight focus:outline-none z-50"
  aria-controls="menu"
  aria-expanded="false"
>
  <svg id="menu-open-icon" class="h-7 w-7" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 6h16M4 12h10M4 18h16" />
  </svg>
  <svg id="menu-close-icon" class="h-7 w-7  hidden hover:text-red-700" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
  </svg>
</button>

<!-- Menú (Visible en Desktop, Oculto en Móvil) -->
<ul id="menu" class="md:mr-4 md:-ml-14 md:flex md:text-base md:items-center md:flex-row md:gap-0 md:relative bg-black w-full h-screen md:h-auto md:w-max absolute top-0 left-0 flex flex-col text-center justify-center text-2xl gap-8 md:z-0 z-40 " role="menu">
  
  <LogoBlanco
    imageType="Logo-Blanco"
    alt="Logo original blanco de onamu publicidad"
    width={150}
    height={29}
    loading="eager"
    sizes="(max-width: 640px) 100vw, (max-width: 768px) 75vw, (max-width: 1024px) 50vw, 33vw"
    class="md:hidden "

  /> 

  <li role="none"><a href="#" class="menu-links" role="menuitem" aria-label="Ir a la página de Inicio">Inicio</a></li>
  <li role="none"><a href="#" class="menu-links" role="menuitem" aria-label="Conocer nuestros Servicios">Servicios</a></li>
  <li role="none"><a href="#" class="menu-links" role="menuitem" aria-label="Saber más sobre nosotros">Nosotros</a></li>
  <li role="none"><a href="#" class="menu-links" role="menuitem" aria-label="Ponerse en contacto">Contacto</a></li>
</ul>

<script>
  // El script se puede colocar antes de la etiqueta </body> para evitar `DOMContentLoaded`
  const menuToggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('menu');
  const openIcon = document.getElementById('menu-open-icon');
  const closeIcon = document.getElementById('menu-close-icon');

  if (!menuToggle || !menu || !openIcon || !closeIcon) {
    console.error('Error: No se pudo encontrar uno o más elementos del menú.');
  } else {
    // Variables de estado
    let isMenuOpen = false;
    let resizeTimeout: number | null = null; // Definición explícita del tipo

    // Función para alternar menú
    const toggleMenu = () => {
      isMenuOpen = !isMenuOpen;

      // Actualiza visibilidad del menú
      menu.classList.toggle('hidden', !isMenuOpen);
      document.body.classList.toggle('overflow-hidden', isMenuOpen);

      // Cambia iconos de abrir/cerrar
      openIcon.classList.toggle('hidden', isMenuOpen);
      closeIcon.classList.toggle('hidden', !isMenuOpen);

      // Añade o elimina clases de posición del botón hamburguesa
      menuToggle.classList.toggle('fixed', isMenuOpen);
      menuToggle.classList.toggle('top-10', isMenuOpen);
      menuToggle.classList.toggle('right-10', isMenuOpen);

      // Actualiza el atributo `aria-expanded`
      menuToggle.setAttribute('aria-expanded', String(isMenuOpen));
    };

    menuToggle.addEventListener('click', toggleMenu);

    // Función para manejar el redimensionamiento de la pantalla
    const handleResize = () => {
      if (window.innerWidth >= 768) {
        if (!isMenuOpen) {
          menu.classList.remove('hidden');
        }
        document.body.classList.remove('overflow-hidden');
        openIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        menuToggle.classList.remove('fixed', 'top-10', 'right-10');
      } else {
        if (!isMenuOpen) {
          menu.classList.add('hidden');
        }
        openIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
      }
      menuToggle.setAttribute('aria-expanded', String(isMenuOpen));
    };

    // Optimización del evento `resize` para reducir recálculos innecesarios
    const optimizedResize = () => {
      if (resizeTimeout !== null) {
        window.cancelAnimationFrame(resizeTimeout);
      }
      resizeTimeout = window.requestAnimationFrame(() => {
        handleResize();
        resizeTimeout = null; // Reinicia a null después de usar
      });
    };

    window.addEventListener('resize', optimizedResize, { passive: true });

    // Inicializa el estado correcto del menú
    handleResize();
  }
</script> 
